---
title: "Take a Hike on the Perfect Trail for You!"
author: Natalia Iannucci, Hana Hirano, and Syrine Matoussi
output: 
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r message = FALSE}
library(tidyverse)
library(macleish)
library(leaflet)
library(sf)
library(ggthemes)
library(ggrepel)
```

```{r message = FALSE}
trail_stream_xings <- macleish_layers %>%
  pluck("trails") %>%
  st_intersection(pluck(macleish_layers, "streams"))

boundary <- macleish_layers %>% 
  pluck("boundary")
macleish_trails <- macleish_layers %>%
  pluck("trails")

interior_trails <- st_intersection(
  boundary, 
  macleish_trails %>%
    filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Porcupine Trail", "Vernal Pool Loop"))
)

trails_leaflet <- leaflet() %>%
  addTiles() %>%
  addPolylines(data = interior_trails) 

trails_leaflet
```

```{r message = FALSE}
elevation <- macleish_layers %>%
  pluck("contours_3m") %>%
  st_transform(4326)
```

```{r message = FALSE}
elevation_trails <- st_intersection(
  interior_trails,
  elevation 
) %>%
  select(name, SHAPE_LEN, geometry)

elevation_trails
```

We have computed the elevation change and the distance for each trail, yet in order for the visitors to understand the difficulty of each trail more easily, we have decided to categorize those 5 trails into 3 difficulty levles: easy, moderate, and strenuous. Our initial plan was to use already existing [hiking trail difficulty rating system] (https://www.nps.gov/shen/planyourvisit/how-to-determine-hiking-difficulty.htm). However, after figuring out that all of the Macleish trails would be categorized as the easiest by Shenandoah's rating system, we kept using the equation to numerize the difficulty but arranged the way we categorize them. Instead of dividing them into easy, moderate, moderately strenuous, strenuous, and very strenuous according to the given difficulty rating, our method is dividing trails into 3 relative to each other. For instance, the difficulties of entry trail and Vernal Pool Loop are below 10, while other 3 trails are over 25, thus, they are easy trails. On the other hand, Western Loop has a high difficulty of over 45, therefore, it is a strenuous trail. 

```{r message = FALSE}
grouped <- elevation_trails %>%
  filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Vernal Pool Loop", "Porcupine Trail")) %>%
  group_by(name) %>%
  summarize(distance = sum(SHAPE_LEN))

grouped$elev_change <- c("78.740", "19.685", "98.425", "19.685", "137.795")
grouped$elev_change <- as.numeric(as.character(grouped$elev_change))

grouped <- grouped %>% 
  mutate("Distance_miles" = distance / 5280) %>%
  mutate("Difficulty" = sqrt(elev_change * 2 * Distance_miles)) %>%
  select(name, elev_change, Distance_miles,Difficulty)

grouped$difficulty_level<-c("moderate","easy","moderate","easy","streneous")
```

```{r message = FALSE}
name_pal <- colorFactor(palette = topo.colors(5), domain = macleish_trails$name)

hiking_trails <- macleish_trails %>% 
  filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Vernal Pool Loop", "Porcupine Trail")) %>%
  group_by(name)

name_map <- leaflet() %>%
  addTiles() %>%
  addPolylines(data = hiking_trails, color = ~name_pal(name))%>%
  addMarkers(data = st_cast(interior_trails, "POINT"), popup = ~name)

name_map
```

```{r message = FALSE}
diff_pal <- colorFactor(palette = topo.colors(2), domain = grouped$difficulty_level)

difficulty_map <- leaflet() %>%
  addTiles() %>%
  addPolylines(data = grouped, color = ~diff_pal(difficulty_level)) %>%
  addMarkers(data = st_cast(hiking_trails, "POINT"), popup = ~name)
```

```{r message = FALSE}
elevation_graph <- ggplot(grouped, aes(x = Distance_miles, y = elev_change)) +
  theme_solarized() +
  geom_smooth(method = 'loess') +
  stat_smooth(se=FALSE, geom="area", method = 'loess', alpha=.5, fill = "Purple") +
  geom_label_repel(aes(label = name), point.padding = 0.5, hjust = "middle", vjust = "center") +
  geom_point(size = 5) +
  xlab("Distance of Trail (in miles)") +
  ylab("Total change in elevation (in feet)") +
  labs(title = "Profiles of Trails in Macleish",face = "bold", size = 25 )
```

```{r message = FALSE}  
elevation_graph
```


SQRT(Elevation Gain(in feet) x 2 x distance (in miles))


Our goal is to determine the difficulty of each trail at MacLeish based on its length and elevation, and to be able to classify trails based on difficulty so that visitors can better decide which trail they would like to take. ^[https://github.com/niannucci/MP3-Macleish]

> Word count: `r wordcountaddin::word_count()`