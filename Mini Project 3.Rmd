---
title: "Take a Hike on the Perfect Trail for You!"
author: Natalia Iannucci, Hana Hirano, and Syrine Matoussi
output: 
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Our goal is to determine the difficulty of each trail at MacLeish based on its length and elevation, and to be able to classify trails based on difficulty so that visitors can better decide which trail they would like to take. ^[https://github.com/niannucci/MP3-Macleish]

```{r message = FALSE, warning=FALSE}
library(tidyverse)
library(macleish)
library(leaflet)
library(sf)
library(ggthemes)
library(ggrepel)
```

```{r message = FALSE, warning=FALSE}
#get trails layer from macleish data set

trail_stream_xings <- macleish_layers %>%
  pluck("trails") %>%
  st_intersection(pluck(macleish_layers, "streams"))

boundary <- macleish_layers %>% 
  pluck("boundary")
macleish_trails <- macleish_layers %>%
  pluck("trails")

interior_trails <- st_intersection(
  boundary, 
  macleish_trails %>%
    filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Porcupine Trail", "Vernal Pool Loop"))
)

trails_leaflet <- leaflet() %>%
  addTiles() %>%
  addPolylines(data = interior_trails) 
```

```{r message = FALSE, warning=FALSE}
elevation <- macleish_layers %>%
  pluck("contours_3m") %>%
  st_transform(4326)
```

```{r message = FALSE, warning=FALSE}
#combine elevation and trail layers

elevation_trails <- st_intersection(
  interior_trails,
  elevation 
) %>%
  select(name, SHAPE_LEN, geometry)

```

We have computed the elevation change and the distance for each trail, yet in order for the visitors to understand the difficulty of each trail more easily, we have decided to categorize those 5 trails into 3 difficulty levels: easy, moderate, and strenuous. Our initial plan was to use already existing [hiking trail difficulty rating system] (https://www.nps.gov/shen/planyourvisit/how-to-determine-hiking-difficulty.htm). However, after figuring out that all of the Macleish trails would be categorized as the easiest by Shenandoah's rating system, we kept using the equation to numerize the difficulty but arranged the way we categorize them. Instead of dividing them into easy, moderate, moderately strenuous, strenuous, and very strenuous according to the given difficulty rating, our method is dividing trails into 3 relative to each other. For instance, the difficulties of entry trail and Vernal Pool Loop are below 10, while other 3 trails are over 25, thus, they are easy trails. On the other hand, Western Loop has a high difficulty of over 45, therefore, it is a strenuous trail. 

```{r message = FALSE, warning=FALSE}
grouped <- elevation_trails %>%
  filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Vernal Pool Loop", "Porcupine Trail")) %>%
  group_by(name) %>%
  summarize(distance = sum(SHAPE_LEN))

grouped$elev_change <- c("78.740", "19.685", "98.425", "19.685", "137.795")
grouped$elev_change <- as.numeric(as.character(grouped$elev_change))

grouped <- grouped %>% 
  mutate("Distance_miles" = distance / 5280) %>%
  mutate("Difficulty" = sqrt(elev_change * 2 * Distance_miles)) %>%
  select(name, elev_change, Distance_miles,Difficulty)

grouped$difficulty_level<-c("moderate","easy","moderate","easy","streneous")
```

```{r message = FALSE, warning=FALSE}
name_pal <- colorFactor(palette = rainbow(5), domain = macleish_trails$name)

hiking_trails <- macleish_trails %>% 
  filter(name %in% c("entry trail", "Western Loop", "Eastern Loop", "Vernal Pool Loop", "Porcupine Trail")) %>%
  group_by(name)

name_map <- leaflet() %>%
  addTiles() %>%
  addPolylines(data = hiking_trails, color = ~name_pal(name))%>%
  addMarkers(data = st_cast(interior_trails, "POINT"), popup = ~name)

name_map
```

```{r message = FALSE, warning=FALSE}
#diff_data <- grouped %>%
 # st_cast("MULTIPOINT") %>%
 # st_cast("POINT") %>%
 # st_as_sf()
#
#diff_pal <- colorFactor(palette = topo.colors(3), domain = diff_data$difficulty_level)
#
#difficulty_map <- leaflet() %>%
#  addTiles() %>%
#  addPolylines(data = diff_data, color = ~diff_pal(difficulty_level))
#
#difficulty_map

```

```{r message = FALSE, warning=FALSE}
elevation_graph <- ggplot(grouped, aes(x = Distance_miles, y = elev_change)) +
  theme_solarized() +
  geom_smooth(method = 'loess') +
  stat_smooth(se = FALSE, geom = "area", method = 'loess', alpha=1, fill = "Purple") +
  geom_label_repel(aes(label = name), point.padding = 0.5, hjust = "middle", vjust = "center") +
  geom_point(size = 5) +
  xlab("Distance of Trail (in miles)") +
  ylab("Total change in elevation (in feet)") +
  labs(title = "Profiles of Trails in Macleish",face = "bold", size = 25 )
 
elevation_graph +
  geom_vline(xintercept = 2.5, color = "black", linetype = "dotted") +
  geom_rect(aes(xmin = 0, xmax= 2.5, ymin = 0, ymax = Inf), fill = "green", alpha = 0.08) +
  geom_vline(xintercept = 6.2, color = "black", linetype = "dotted") +
  geom_rect(aes(xmin =2.5, xmax= 6, ymin = 0, ymax = Inf), fill = "yellow", alpha = 0.08) +
  geom_rect(aes(xmin = 6, xmax = 7, ymin = 0, ymax = Inf), fill = "red", alpha = 0.08)
```

Based on our findings, we recommend that Smith College add new markers to each of their trails to give visitors more information about the difficulty level of each trail so that they can better decide which to take. Each trail should be labeled "easy", "moderate", or "strenuous" based on length and changes in elevation. MacLeish Field Station should add a sign outlining each trail and saying which difficulty level each is, and then include descriptions of each difficulty level and what each means. "Easy" means the trail is suggested for those who prefer a leisurely walk, children, or people with mobility issues. The trails marked "moderate" are suggested to beginner hikers or people looking for a bit of casual exercise. The "strenuous" trails are suggested for experienced hikers or people looking for a challenge or an intense workout. This sign and details would be very helpful to visitors as they would be more satisfied with their time at MacLeish.

It would not take extensive resources for Smith to implement this sign marker at MacLeish. It will cost some money to get a sign made, but not too much because only one sign would be needed rather than new signs or markers throughout to entire Field Station. This also means that it will take a very short period of time, as once the sign is made it will just need to be put up. Because this project does not require creating new spaces or sites on the Field Station, but rather is simply a marking system, it should be a relatively smooth implementation.

> Word count: `r wordcountaddin::word_count()`